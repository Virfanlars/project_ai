2025-05-24 21:12:27,829 [INFO] 开始数据提取流程，时间: 2025-05-24 21:12:27
2025-05-24 21:12:37,080 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 21:12:37,197 [INFO] 数据库连接优化完成
2025-05-24 21:12:37,198 [INFO] 获取脓毒症患者数据...
2025-05-24 21:12:37,817 [ERROR] 获取脓毒症患者数据失败: Execution failed on sql '
        SELECT s.subject_id, s.hadm_id, s.stay_id, 
               s.sepsis3, s.sofa_time, s.sofa_score,
               s.respiration_24hours as resp_score,
               s.coagulation_24hours as coag_score,
               s.liver_24hours as liver_score,
               s.cardiovascular_24hours as cardio_score,
               s.cns_24hours as cns_score,
               s.renal_24hours as renal_score,
               s.sepsis3_onset_time,
               i.intime, i.outtime,
               EXTRACT(EPOCH FROM (i.outtime - i.intime))/3600 AS stay_hours
        FROM mimiciv_derived.sepsis3 s
        JOIN mimiciv_icu.icustays i ON s.stay_id = i.stay_id
        WHERE s.sepsis3 = 1
        ORDER BY s.subject_id, s.hadm_id, s.stay_id
         LIMIT 1000': 错误:  字段 s.stay_id 不存在
LINE 14:         JOIN mimiciv_icu.icustays i ON s.stay_id = i.stay_id
                                                ^
HINT:  也许您想要引用列"i.stay_id"。

2025-05-24 21:12:37,825 [ERROR] 未能获取脓毒症患者数据，终止流程
2025-05-24 21:13:28,327 [INFO] 开始数据提取流程，时间: 2025-05-24 21:13:28
2025-05-24 21:13:28,563 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 21:13:28,923 [INFO] 数据库连接优化完成
2025-05-24 21:13:28,923 [INFO] 获取脓毒症患者数据...
2025-05-24 21:13:29,736 [ERROR] 获取脓毒症患者数据失败: Execution failed on sql '
        SELECT s.subject_id, s.hadm_id, s.icustay_id as stay_id, 
               s.sepsis3, s.sofa_time, s.sofa_score,
               s.respiration_24hours as resp_score,
               s.coagulation_24hours as coag_score,
               s.liver_24hours as liver_score,
               s.cardiovascular_24hours as cardio_score,
               s.cns_24hours as cns_score,
               s.renal_24hours as renal_score,
               s.sepsis3_onset_time,
               i.intime, i.outtime,
               EXTRACT(EPOCH FROM (i.outtime - i.intime))/3600 AS stay_hours
        FROM mimiciv_derived.sepsis3 s
        JOIN mimiciv_icu.icustays i ON s.icustay_id = i.stay_id
        WHERE s.sepsis3 = 1
        ORDER BY s.subject_id, s.hadm_id, s.icustay_id
         LIMIT 1000': 错误:  字段 s.sofa_time 不存在
LINE 3:                s.sepsis3, s.sofa_time, s.sofa_score,
                                  ^

2025-05-24 21:13:29,742 [ERROR] 未能获取脓毒症患者数据，终止流程
2025-05-24 21:20:57,662 [INFO] 开始数据提取流程，时间: 2025-05-24 21:20:57
2025-05-24 21:20:58,914 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 21:20:59,028 [INFO] 数据库连接优化完成
2025-05-24 21:20:59,028 [INFO] 获取脓毒症患者数据...
2025-05-24 21:20:59,613 [ERROR] 获取脓毒症患者数据失败: Execution failed on sql '
        SELECT s.subject_id, s.hadm_id, s.icustay_id, 
               s.sepsis3, s.infection_time, s.infection_hour, s.hr,
               s.sofa_score, s.sofa_baseline, s.sofa_increase,
               s.sepsis3_onset_time,
               i.intime, i.outtime,
               EXTRACT(EPOCH FROM (i.outtime - i.intime))/3600 AS stay_hours
        FROM mimiciv_derived.sepsis3 s
        JOIN mimiciv_icu.icustays i ON s.icustay_id = i.stay_id
        WHERE s.sepsis3 = 1
        ORDER BY s.subject_id, s.hadm_id, s.icustay_id
         LIMIT 1000': 错误:  字段 s.sepsis3_onset_time 不存在
LINE 5:                s.sepsis3_onset_time,
                       ^

2025-05-24 21:20:59,616 [ERROR] 未能获取脓毒症患者数据，终止流程
2025-05-24 21:24:48,569 [INFO] 开始数据提取流程，时间: 2025-05-24 21:24:48
2025-05-24 21:24:48,846 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 21:24:49,004 [INFO] 数据库连接优化完成
2025-05-24 21:24:49,004 [INFO] 获取脓毒症患者数据...
2025-05-24 21:24:51,700 [INFO] 找到 1000 名脓毒症患者
2025-05-24 21:24:51,733 [INFO] 脓毒症患者数据已保存至 ./data\processed\sepsis_patients.csv
2025-05-24 21:24:51,734 [INFO] 获取非脓毒症患者作为对照组...
2025-05-24 21:24:52,832 [INFO] 找到 2000 名非脓毒症患者作为对照组
2025-05-24 21:24:52,853 [INFO] 对照组患者数据已保存至 ./data\processed\control_patients.csv
2025-05-24 21:24:52,904 [INFO] 合并后共有 3000 名患者，数据已保存至 ./data\processed\all_patients.csv
2025-05-24 21:24:52,904 [INFO] 分批提取SOFA评分数据，共 3000 个stay_id，批次大小 100
2025-05-24 21:24:52,905 [INFO] 共分为 30 个批次
2025-05-24 21:24:59,072 [INFO] 已完成 10/30 批次的SOFA评分数据提取
2025-05-24 21:25:08,819 [INFO] 已完成 20/30 批次的SOFA评分数据提取
2025-05-24 21:25:16,747 [INFO] 已完成 30/30 批次的SOFA评分数据提取
2025-05-24 21:25:16,752 [INFO] 共提取了 136370 条SOFA评分记录
2025-05-24 21:25:17,162 [INFO] SOFA评分数据已保存至 ./data\processed\sofa_scores.csv
2025-05-24 21:25:17,165 [INFO] 分批提取生命体征数据，共 3000 个stay_id，批次大小 100
2025-05-24 21:25:17,165 [INFO] 共分为 30 个批次
2025-05-24 21:55:07,889 [INFO] 已完成 10/30 批次的生命体征数据提取
2025-05-24 22:48:53,309 [INFO] 开始数据提取流程，时间: 2025-05-24 22:48:53
2025-05-24 22:48:54,269 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 22:48:54,347 [INFO] 数据库连接优化完成
2025-05-24 22:48:54,348 [INFO] 加载已有的脓毒症患者数据: ./data\processed\sepsis_patients.csv
2025-05-24 22:48:54,367 [INFO] 加载已有的对照组患者数据: ./data\processed\control_patients.csv
2025-05-24 22:48:54,374 [INFO] 加载已有的合并患者数据: ./data\processed\all_patients.csv
2025-05-24 22:48:54,386 [INFO] 加载已有的SOFA评分数据: ./data\processed\sofa_scores.csv
2025-05-24 22:48:54,582 [INFO] 提取生命体征数据...
2025-05-24 22:48:54,583 [INFO] 分批提取生命体征数据，共 3000 个stay_id，批次大小 20
2025-05-24 22:48:54,601 [INFO] 设置查询超时: 300秒
2025-05-24 22:48:54,601 [INFO] 共分为 150 个批次
2025-05-24 22:48:55,873 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 22:50:20,621 [INFO] 批次 1/150 成功提取 343 条生命体征记录
2025-05-24 22:50:21,151 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 22:53:04,964 [INFO] 批次 2/150 成功提取 126 条生命体征记录
2025-05-24 22:53:05,272 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 22:53:55,122 [INFO] 批次 3/150 成功提取 171 条生命体征记录
2025-05-24 22:53:55,597 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 22:54:46,498 [INFO] 批次 4/150 成功提取 135 条生命体征记录
2025-05-24 22:54:46,911 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 22:57:31,019 [INFO] 批次 5/150 成功提取 772 条生命体征记录
2025-05-24 22:57:31,029 [INFO] 已保存中间结果至 ./data\processed\vital_signs_interim_5.csv，当前共 1547 条记录
2025-05-24 22:57:31,298 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:00:17,888 [INFO] 批次 6/150 成功提取 863 条生命体征记录
2025-05-24 23:00:18,254 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:01:08,605 [INFO] 批次 7/150 成功提取 710 条生命体征记录
2025-05-24 23:01:08,853 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:01:57,687 [INFO] 批次 8/150 成功提取 450 条生命体征记录
2025-05-24 23:01:58,021 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:03:47,978 [INFO] 批次 9/150 成功提取 447 条生命体征记录
2025-05-24 23:03:48,268 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:05:04,536 [INFO] 开始数据提取流程，时间: 2025-05-24 23:05:04
2025-05-24 23:05:04,537 [INFO] 数据限制模式: 启用
2025-05-24 23:05:04,537 [INFO] 每类患者最多处理: 100名
2025-05-24 23:05:04,537 [INFO] 每个患者最多生命体征记录: 100条
2025-05-24 23:05:04,537 [INFO] 每个患者最多实验室检查记录: 50条
2025-05-24 23:05:04,830 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:05:04,929 [INFO] 数据库连接优化完成
2025-05-24 23:05:04,930 [INFO] 加载已有的脓毒症患者数据: ./data\processed\sepsis_patients.csv
2025-05-24 23:05:04,942 [INFO] 限制脓毒症患者数量为100
2025-05-24 23:05:04,946 [INFO] 加载已有的对照组患者数据: ./data\processed\control_patients.csv
2025-05-24 23:05:04,951 [INFO] 限制对照组患者数量为100
2025-05-24 23:05:04,958 [INFO] 合并后共有 141 名患者，数据已保存至 ./data\processed\all_patients_limited.csv
2025-05-24 23:05:04,958 [INFO] 共有 141 个唯一ICU停留和 141 个唯一入院
2025-05-24 23:05:04,958 [INFO] 跳过完整的数据提取，直接使用已有数据处理时间序列...
2025-05-24 23:05:04,958 [INFO] 使用已有的生命体征中间结果: ./data\processed\vital_signs_interim_5.csv
2025-05-24 23:05:04,963 [INFO] 限制生命体征数据量...
2025-05-24 23:05:04,971 [INFO] 限制后的生命体征记录数: 472
2025-05-24 23:05:04,972 [INFO] 加载已有的SOFA评分数据: ./data\processed\sofa_scores.csv
2025-05-24 23:05:05,072 [INFO] 筛选后的SOFA评分记录数: 11649
2025-05-24 23:05:05,073 [INFO] 提取少量实验室检查数据样本...
2025-05-24 23:05:05,073 [INFO] 分批提取实验室检查数据，共 20 个hadm_id，批次大小 5
2025-05-24 23:05:05,099 [INFO] 设置查询超时: 300秒
2025-05-24 23:05:05,099 [INFO] 共分为 4 个批次
2025-05-24 23:05:05,395 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:07:59,276 [INFO] 批次 1/4 成功提取 283 条实验室检查记录
2025-05-24 23:07:59,560 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:08:44,949 [INFO] 批次 2/4 成功提取 314 条实验室检查记录
2025-05-24 23:08:45,266 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:09:07,252 [INFO] 批次 3/4 成功提取 262 条实验室检查记录
2025-05-24 23:09:07,536 [INFO] 成功连接到数据库: 172.16.3.67:5432/mimiciv
2025-05-24 23:09:29,360 [INFO] 批次 4/4 成功提取 485 条实验室检查记录
2025-05-24 23:09:29,379 [INFO] 已保存中间结果至 ./data\processed\lab_values_interim_4.csv，当前共 1344 条记录
2025-05-24 23:09:29,381 [INFO] 共提取了 1344 条实验室检查记录
2025-05-24 23:09:29,388 [INFO] 实验室检查数据已保存至 ./data\processed\lab_values.csv
2025-05-24 23:09:29,388 [INFO] 限制实验室检查数据量...
2025-05-24 23:09:29,400 [INFO] 限制后的实验室检查记录数: 817
2025-05-24 23:09:29,400 [INFO] 提取少量药物数据样本...
2025-05-24 23:09:29,401 [INFO] 分批提取药物数据，共 10 个hadm_id，批次大小 5
2025-05-24 23:09:47,106 [INFO] 共提取了 42 条药物记录
2025-05-24 23:09:47,114 [INFO] 药物数据已保存至 ./data\processed\medications.csv
2025-05-24 23:09:47,116 [INFO] 保存了 42 条药物记录
2025-05-24 23:09:47,116 [INFO] 使用有限数据处理时间序列...
2025-05-24 23:09:47,117 [INFO] 处理时间序列数据...
2025-05-24 23:09:47,149 [WARNING] 患者 10001217 的时间范围过短，跳过
2025-05-24 23:09:47,285 [WARNING] 患者 10004401 的时间范围过短，跳过
2025-05-24 23:09:47,347 [WARNING] 患者 10005593 的时间范围过短，跳过
2025-05-24 23:09:47,362 [WARNING] 患者 10005817 的时间范围过短，跳过
2025-05-24 23:09:47,365 [WARNING] 患者 10005866 的时间范围过短，跳过
2025-05-24 23:09:47,377 [WARNING] 患者 10006508 的时间范围过短，跳过
2025-05-24 23:09:47,386 [WARNING] 患者 10007795 的时间范围过短，跳过
2025-05-24 23:09:47,420 [WARNING] 患者 10008924 的时间范围过短，跳过
2025-05-24 23:09:47,429 [WARNING] 患者 10009049 的时间范围过短，跳过
2025-05-24 23:09:47,430 [WARNING] 患者 10008089 的时间范围过短，跳过
2025-05-24 23:09:47,444 [WARNING] 患者 10009686 的时间范围过短，跳过
2025-05-24 23:09:47,488 [WARNING] 患者 10026354 的时间范围过短，跳过
2025-05-24 23:09:47,513 [WARNING] 患者 10054464 的时间范围过短，跳过
2025-05-24 23:09:47,557 [WARNING] 患者 10085784 的时间范围过短，跳过
2025-05-24 23:09:47,646 [WARNING] 患者 10112484 的时间范围过短，跳过
2025-05-24 23:09:47,647 [WARNING] 患者 10122772 的时间范围过短，跳过
2025-05-24 23:09:47,659 [WARNING] 患者 10125859 的时间范围过短，跳过
2025-05-24 23:09:47,736 [WARNING] 患者 10157256 的时间范围过短，跳过
2025-05-24 23:09:47,748 [WARNING] 患者 10171525 的时间范围过短，跳过
2025-05-24 23:09:47,752 [WARNING] 患者 10173672 的时间范围过短，跳过
2025-05-24 23:09:47,753 [WARNING] 患者 10173815 的时间范围过短，跳过
2025-05-24 23:09:47,754 [WARNING] 患者 10174759 的时间范围过短，跳过
2025-05-24 23:09:47,770 [WARNING] 患者 10178955 的时间范围过短，跳过
2025-05-24 23:09:47,868 [WARNING] 患者 10208454 的时间范围过短，跳过
2025-05-24 23:09:47,916 [WARNING] 患者 10239566 的时间范围过短，跳过
2025-05-24 23:09:47,958 [WARNING] 患者 10249829 的时间范围过短，跳过
2025-05-24 23:09:48,013 [WARNING] 患者 10287750 的时间范围过短，跳过
2025-05-24 23:09:48,098 [WARNING] 患者 10314833 的时间范围过短，跳过
2025-05-24 23:09:48,100 [WARNING] 患者 10316510 的时间范围过短，跳过
2025-05-24 23:09:48,122 [WARNING] 患者 10326027 的时间范围过短，跳过
2025-05-24 23:09:48,124 [WARNING] 患者 10327156 的时间范围过短，跳过
2025-05-24 23:09:48,126 [WARNING] 患者 10328933 的时间范围过短，跳过
2025-05-24 23:09:48,156 [WARNING] 患者 10350765 的时间范围过短，跳过
2025-05-24 23:09:48,157 [WARNING] 患者 10354409 的时间范围过短，跳过
2025-05-24 23:09:48,238 [WARNING] 患者 10387770 的时间范围过短，跳过
2025-05-24 23:09:48,240 [WARNING] 患者 10388675 的时间范围过短，跳过
2025-05-24 23:09:48,242 [WARNING] 患者 10392073 的时间范围过短，跳过
2025-05-24 23:09:48,256 [WARNING] 患者 10398549 的时间范围过短，跳过
2025-05-24 23:09:48,258 [WARNING] 患者 10398564 的时间范围过短，跳过
2025-05-24 23:09:48,261 [WARNING] 患者 10407582 的时间范围过短，跳过
2025-05-24 23:09:48,291 [INFO] 创建了 2141 条时间序列记录
2025-05-24 23:09:48,291 [INFO] 添加生命体征数据...
2025-05-24 23:09:52,904 [INFO] 添加实验室检查数据...
2025-05-24 23:10:03,872 [INFO] 添加SOFA评分数据...
2025-05-24 23:10:07,896 [INFO] 添加药物使用数据...
2025-05-24 23:10:09,898 [INFO] 时间序列数据已保存至 ./data\processed\time_series.csv
2025-05-24 23:10:09,928 [INFO] 保存了 2141 条时间序列记录
2025-05-24 23:10:09,929 [INFO] 使用简化数据创建训练集、验证集和测试集...
2025-05-24 23:10:09,929 [INFO] 创建训练集、验证集和测试集...
2025-05-24 23:10:10,222 [INFO] 训练集: 1282 行, 60 名患者
2025-05-24 23:10:10,222 [INFO] 验证集: 433 行, 20 名患者
2025-05-24 23:10:10,222 [INFO] 测试集: 426 行, 21 名患者
2025-05-24 23:10:10,223 [INFO] 训练集脓毒症患者比例: 24.73%
2025-05-24 23:10:10,223 [INFO] 验证集脓毒症患者比例: 25.87%
2025-05-24 23:10:10,223 [INFO] 测试集脓毒症患者比例: 25.82%
2025-05-24 23:10:10,260 [INFO] 训练集已保存至 ./data\processed\train.csv
2025-05-24 23:10:10,261 [INFO] 验证集已保存至 ./data\processed\val.csv
2025-05-24 23:10:10,261 [INFO] 测试集已保存至 ./data\processed\test.csv
2025-05-24 23:10:10,261 [INFO] 数据集特征数量: 22
2025-05-24 23:10:10,263 [INFO] 缺失率超过50%的特征: hours_to_sepsis, resp_rate, heart_rate, spo2, temperature, bilirubin_total, lactate, platelet, wbc, sodium, bun, creatinine, chloride, antibiotic, vasopressor
2025-05-24 23:10:10,264 [INFO] 数据提取完成，总耗时: 305.73 秒 (5.10 分钟)
2025-05-24 23:10:10,264 [INFO] ============= 数据提取摘要（限制模式）=============
2025-05-24 23:10:10,264 [INFO] 脓毒症患者数: 41
2025-05-24 23:10:10,265 [INFO] 对照组患者数: 100
2025-05-24 23:10:10,265 [INFO] 总患者数: 141
2025-05-24 23:10:10,265 [INFO] SOFA评分记录数: 11649
2025-05-24 23:10:10,266 [INFO] 生命体征记录数: 472
2025-05-24 23:10:10,266 [INFO] 实验室检查记录数: 817
2025-05-24 23:10:10,266 [INFO] 药物记录数: 42
2025-05-24 23:10:10,266 [INFO] 时间序列记录数: 2141
2025-05-24 23:10:10,267 [INFO] =======================================
